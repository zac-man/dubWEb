<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.css" media="screen">
    <link rel="stylesheet" href="/bower_components/font-awesome/css/font-awesome.css" media="screen">
    <link rel="stylesheet" href="/bower_components/DataTables/media/css/jquery.dataTables.min.css" media="screen">

    <link rel="stylesheet" href="/assets/sbAdmin2/css/sb-admin-2.css" media="screen">
    <link rel="stylesheet" href="/assets/sbAdmin2/css/metisMenu.min.css" media="screen">
    <link rel="stylesheet" href="/assets/audioplayer/css/audioplayer.css" media="screen">

    <!--<link rel="shortcut icon" href="imgs/favicon/favicon.ico" type="image/x-icon">-->
    <!--<link rel="icon" href="imgs/favicon/favicon.ico" type="image/x-icon">-->
</head>
<body screen_capture_injected="true">
<div id="wrapper">

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/admin/system">样音管理后台</a>
        </div>
        <!-- /.navbar-header -->

        <ul class="nav navbar-top-links navbar-right">
            <li>
                <a href="/admin/logout"><i class="fa fa-sign-out fa-fw"></i> 退出</a>
            </li>
        </ul>
        <!-- /.navbar-top-links -->

      <!--  <div class="navbar-default sidebar" role="navigation">
            <div class="sidebar-nav navbar-collapse">
                <ul class="nav" id="side-menu">
                    <li class="active">
                        <a href="javascript:;"><i class="fa fa-music fa-fw"></i> 我的样音</a>
                    </li>
                </ul>
            </div>
            &lt;!&ndash; /.sidebar-collapse &ndash;&gt;
        </div>-->
        <!-- /.navbar-static-side -->
    </nav>

    <!-- Page Content -->
    <div>
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel-body">
                        <!-- Nav tabs -->
                        <ul class="nav nav-tabs">
                            <li class="active"><a href="#dubList" data-toggle="tab" aria-expanded="false">样音列表</a>
                            </li>
                            <li class=""><a href="#dubUpload" data-toggle="tab" aria-expanded="true">上传样音</a>
                            </li>
                        </ul>
                        <!-- Tab panes -->
                        <div class="tab-content">
                            <div class="tab-pane active fade in" id="dubList">
                                <div class="panel panel-default">
                                    <div class="panel-body">
                                        <table id="dubListTable" class="table table-striped table-bordered table-hover dataTable no-footer" width="100%" role="grid" aria-describedby="dt_basic_info" style="width: 100%;">
                                            <thead>
                                            <tr role="row">
                                                <th width="5%"></th>
                                                <th width="35%">样音名</th>
                                                <th width="10%">样音类型</th>
                                                <th width="30%">样音播放</th>
                                                <th width="10%">时间</th>
                                                <th width="10%">操作</th>
                                            </tr>
                                            </thead>
                                        </table>
                                    </div>
                                </div>

                            </div>
                            <div class="tab-pane fade in" id="dubUpload">
                                <div class="col-md-12" style="padding-top: 20px;">
                                    <form class="form-horizontal">
                                        <div class="form-group col-md-12">
                                            <label for="dubType" class="col-md-2 control-label">样音类型:</label>
                                            <div class="col-md-8">
                                                <select class="form-control" id="dubType" style="width: 500px;">
                                                    <option value="专题配音" selected>专题配音</option>
                                                    <option value="广告配音" >广告配音</option>
                                                    <option value="飞碟说配音" >飞碟说配音</option>
                                                    <option value="英语配音" >英语配音</option>
                                                    <option value="游戏配音" >游戏配音</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group col-md-12">
                                            <label for="dubName" class="col-md-2 control-label">样音名:</label>
                                            <div class="col-md-8">
                                                <input type="text" class="form-control" id="dubName" placeholder="样音名" style="width: 500px;">
                                            </div>
                                        </div>
                                    </form>
                                    <form class="form-horizontal"
                                          id="frmUploader"
                                          enctype="multipart/form-data"
                                          action="/upload"
                                          method="post">
                                       <div class="form-group col-md-12">
                                           <label for="uploadFile" class="col-md-2 control-label">上传音频：</label>
                                           <div class="col-md-8">
                                               <input style="float: left;width: 500px;border: none;box-shadow: none;" class="form-control" id="uploadFile" type="file" name="imgUploader" multiple  />
                                               <button style="float: left;margin-left: 50px;" class="btn btn-warning" type="submit" name="submit" id="btnSubmit">上传附件</button>
                                           </div>
                                       </div>
                                        <div class="form-group col-md-12">
                                            <div class="col-md-6">
                                                <p style="padding: 10px; display: none" class="bg-warning" id="dubUrl"></p>
                                            </div>
                                        </div>
                                    </form>
                                    <form class="form-horizontal">
                                        <div class="form-group col-md-12">
                                            <div class="col-md-offset-1 col-md-4" style="">
                                                <button type="button" class="btn btn-success" id="saveBtn">保存数据</button>
                                                <a href="/admin/system" class="btn btn-danger" id="resetBtn">重置表单</a>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
        </div>
        <!-- /.container-fluid -->
    </div>
    <!-- /#page-wrapper -->

</div>
<!-- /#wrapper -->


<script src="/bower_components/jquery/dist/jquery.min.js"></script>
<script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/bower_components/DataTables/media/js/jquery.dataTables.min.js"></script>
<script src="/bower_components/DataTables/media/js/i18n.zh.js"></script>
<script src="/assets/sbAdmin2/js/metisMenu.min.js"></script>
<script src="/assets/sbAdmin2/js/sb-admin-2.js"></script>
<script src="/assets/audioplayer/js/audioplayer.js"></script>
<script src="/assets/jquery.form.min.js"></script>
<script>
    $(document).ready(function () {
        var options = {
            beforeSubmit: showRequest,  // pre-submit callback
            success: showResponse  // post-submit callback
        };

        // bind to the form's submit event
        $('#frmUploader').submit(function () {
            $("#btnSubmit").attr("disabled",true);
            $(this).ajaxSubmit(options);
            return false;
        });
        // pre-submit callback
        function showRequest(formData, jqForm, options) {
            // alert('Uploading is starting.');
            return true;
        }
        // post-submit callback
        function showResponse(responseText, statusText, xhr, $form) {
            console.log(responseText);
            $("#btnSubmit").attr("disabled",false);
            $("#dubUrl").show().text(responseText.files[0].filename);
            //alert('status: ' + statusText + '\n\nresponseText: \n' + responseText );
        }



        var table = $('#dubListTable').DataTable( {
            "ajax": {
                "url":"/api/dubAll"
            },
            "searching":true,
            "bLengthChange": true,
            "aLengthMenu": [[4, 10, 20, -1], [4, 10, 20, "所有"]],
            "iDisplayLength":4,
            "columns": [
                { "data": null},
                { "data": "name"},
                { "data": "type"},
                { "data": null},
                { "data": "createTime"},
                { "data": null }
            ],
            columnDefs:[
                {
                    "searchable": false,
                    "orderable": false,
                    "targets": 0
                },
                {
                    "searchable": false,
                    "orderable": false,
                    targets: 3,
                    render: function (data, type, row, meta) {

                        return  '<audio class="audioEle" src="/upload/'+data.url+'" preload="auto" controls loop></audio>';
                    }
                },
                {
                    targets: 5,
                    render: function (data, type, row, meta) {
                        return  '<button type="button" class="btn btn-xs btn-success btnAddProduct">修改</button><button type="button" class="btn btn-xs btn-danger btnAddProduct">删除</button>';
                    }
                },
                { "orderable": false, "targets":4 }
            ],
            "order": [[1, 'asc']],
            "fnPreDrawCallback": function( oSettings ) {
            },
            "initComplete": function(settings, json) {
                $(".audioEle").audioPlayer();
            }
        } );
        table.on('order.dt search.dt',
                function() {
                    table.column(0, {
                        search: 'applied',
                        order: 'applied'
                    }).nodes().each(function(cell, i) {
                        cell.innerHTML = i + 1;
                    });
                }).draw();


        $("#saveBtn").click(function(){
            var dubDate ={
                type:$("#dubType").val(),
                name:$("#dubName").val(),
                url:$("#dubUrl").text()
            };
            console.log(dubDate);
            saveData(dubDate);
        });

        function saveData(dubDate){
            $.ajax({
                url: '/api/create',
                type: 'POST',
                data: dubDate,
                cache: false,
                success: function(data){
                    if(!data.success){
                        alert("存储信息不全，请检查");
                    }else{
                        alert("保存成功");
                    }
                },
                error: function(){
                    alert("与服务器通信发生错误");
                }
            });
        }

    });

</script>
</body>
</head>
</html>
